{"version":3,"sources":["sprog/dom/canvas.cljs"],"mappings":"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","names":["var_args","args__5772__auto__","len__5766__auto__","i__5767__auto__","argseq__5773__auto__","cljs.core/IndexedSeq","sprog.dom.canvas/get-context","seq30998","G__30999","cljs.core/first","cljs.core/next","self__5751__auto__","canvas","options","cljs.core/clj->js","sprog.dom.canvas/create-context","p__31012","map__31013","cljs.core/--destructure-map","cljs.core.get","seq31005","G__31006","id","append-to-body?","preserve-drawing-buffer?","stencil?","js/document.createElement","gl","sprog.dom.canvas.get_context","cljs.core/boolean","js/document.body","sprog.dom.canvas/maximize-canvas","p__31037","map__31038","seq31027","G__31028","max-pixel-ratio","square?","raw-width","js/window.innerWidth","raw-height","js/window.innerHeight","pixel-ratio","x__5131__auto__","y__5132__auto__","js/window.devicePixelRatio","style","raw-size","size","vec__31048","cljs.core.nth","width","height","cljs.core.mapv","cljs.core.partial","cljs.core/*","sprog.dom.canvas/maximize-gl-canvas","seq31059","G__31060","cljs.core.apply","sprog.dom.canvas/resize-canvas","p__31077","map__31078","seq31070","G__31071","G__31072","pixel-dimensions","vec__31079","vec__31082","style-width","style-height","p1__31066#","x__5128__auto__","y__5129__auto__","sprog.dom.canvas/resize-gl-canvas","seq31093","G__31094","G__31095","sprog.dom.canvas/canvas-resolution","sprog.dom.canvas/save-image","name","blob","a","js/document.body.appendChild","url","js/window.URL.createObjectURL","js/document.body.removeChild","sprog.dom.canvas/set-page-background-color","color","js/document.body.style.backgroundColor","cljs.core/str","p1__31108#","cljs.core.map","hex","cljs.core._EQ_","cljs.core/count"],"sourcesContent":["(ns sprog.dom.canvas\n  (:require [sprog.util :as u]))\n\n(defn get-context [canvas & options]\n  (.getContext canvas\n               \"webgl2\"\n               (when options \n                 (clj->js options))))\n\n(defn create-context [id & {:keys [append-to-body?\n                                   preserve-drawing-buffer?\n                                   stencil?]}]\n  (let [canvas (js/document.createElement \"canvas\")\n        gl (get-context canvas\n                        {\"preserveDrawingBuffer\" \n                         (boolean preserve-drawing-buffer?)\n                         \"stencil\" \n                         (boolean stencil?)})]\n    (set! (.-id canvas) (str id))\n    (when append-to-body?\n      (set! (.-position canvas.style) \"absolute\")\n      (.appendChild js/document.body canvas))\n    gl))\n\n(defn maximize-canvas [canvas & {:keys [max-pixel-ratio square?]}]\n  (let [raw-width js/window.innerWidth\n        raw-height js/window.innerHeight\n        pixel-ratio (if max-pixel-ratio\n                      (min js/window.devicePixelRatio max-pixel-ratio)\n                      js/window.devicePixelRatio)\n        style canvas.style]\n    (if square?\n      (let [raw-size (min raw-width raw-height)\n            pixel-ratio (if max-pixel-ratio\n                          (min js/window.devicePixelRatio max-pixel-ratio)\n                          js/window.devicePixelRatio)\n            size (* raw-size pixel-ratio)]\n        (set! (.-left style) (* (- raw-width raw-size) 0.5))\n        (set! (.-top style) (* (- raw-height raw-size) 0.5))\n        (set! (.-width style) (str raw-size \"px\"))\n        (set! (.-height style) (str raw-size \"px\"))\n        (set! (.-width canvas) size)\n        (set! (.-height canvas) size))\n      (let [[width height] (mapv (partial * pixel-ratio)\n                                 [raw-width raw-height])]\n        (set! (.-left style) 0)\n        (set! (.-top style) 0)\n        (set! (.-width style) (str raw-width \"px\"))\n        (set! (.-height style) (str raw-height \"px\"))\n        (set! (.-width canvas) width)\n        (set! (.-height canvas) height)))))\n\n(defn maximize-gl-canvas [gl & options]\n  (apply (partial maximize-canvas gl.canvas) options))\n\n(defn resize-canvas [canvas pixel-dimensions & {:keys [max-pixel-ratio]}]\n  (let [pixel-ratio (if max-pixel-ratio\n                      (min js/window.devicePixelRatio max-pixel-ratio)\n                      js/window.devicePixelRatio)\n        style canvas.style\n        [width height] (if (number? pixel-dimensions)\n                         [pixel-dimensions pixel-dimensions]\n                         pixel-dimensions)\n        raw-width js/window.innerWidth\n        raw-height js/window.innerHeight\n        [style-width style-height] (mapv #(/ % pixel-ratio) [width height])]\n    (set! (.-left style) (max 0\n                              (* 0.5 (- raw-width style-width))))\n    (set! (.-top style) (max 0\n                             (* 0.5 (- raw-height style-height))))\n    (set! (.-width style) (str (/ width pixel-ratio) \"px\"))\n    (set! (.-height style) (str (/ height pixel-ratio) \"px\"))\n    (set! (.-width canvas) width)\n    (set! (.-height canvas) height)))\n\n(defn resize-gl-canvas [gl pixel-dimensions & options]\n  (apply (partial resize-canvas gl.canvas pixel-dimensions) options))\n\n(defn canvas-resolution [gl]\n  [gl.canvas.width gl.canvas.height])\n\n(defn save-image [canvas name]\n  (.toBlob canvas\n           (fn [blob]\n             (let [a (js/document.createElement \"a\")]\n               (js/document.body.appendChild a)\n               (let [url (js/window.URL.createObjectURL blob)]\n                 (set! a.href url)\n                 (set! a.download (str name \".png\"))\n                 (.click a))\n               (js/document.body.removeChild a))))) \n\n(defn set-page-background-color [color]\n  (set! js/document.body.style.backgroundColor\n        (apply str \"#\"\n               (map #(let [hex (.toString % 16)]\n                       (if (= (count hex) 1)\n                         (str \"0\" hex)\n                         hex))\n                    color))))\n"]}